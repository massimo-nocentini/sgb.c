\input cwebmac




\N{1}{1}Intro. A trivial program to  create an SGB graph. The first line of
standard
input lists the vertex names; the remaining lines list the (directed) edges,
as triples \.{x y $d$}.

An optional command-line argument gives the name of the graph. For example,
if the name is \.{test}, the graph is saved as \.{/tmp/test.gb}.

\Y\B\4\D$\\{maxn}$ \5
\T{100000}\C{ at most this many vertices }\par
\B\4\D$\\{maxl}$ \5
\T{3}\C{ maximum length of vertex name }\par
\B\4\D$\\{bufsize}$ \5
$(\\{maxl}+\T{1})*\\{maxn}+{}$\T{2}\par
\Y\B\8\#\&{include} \.{<stdio.h>}\6
\8\#\&{include} \.{<stdlib.h>}\6
\8\#\&{include} \.{"gb\_graph.h"}\6
\8\#\&{include} \.{"gb\_save.h"}\6
\&{char} ${}\\{buf}[\\{bufsize}+\T{1}];{}$\6
\&{char} ${}\\{names}[\\{maxn}][\\{maxl}+\T{1}];{}$\6
\&{char} ${}\\{nbuf}[\\{maxl}+\T{1}];{}$\6
\&{char} ${}\\{filenamebuf}[\.{ID\_FIELD\_SIZE}+\T{8}]\K%
\.{"/tmp/makegraph.gb"};{}$\7
\1\1\&{int} \\{main}(\&{int} \\{argc}${},\39{}$\&{char} ${}{*}\\{argv}[\,])\2%
\2{}$\6
${}\{{}$\1\6
\&{register} \&{int} \|j${},\39\|k,\39\|m,\39\|n,\39\|d;{}$\6
\&{Graph} ${}{*}\|g;{}$\6
\&{Vertex} ${}{*}\|u,\39{*}\|v;{}$\7
\X2:Input the vertices\X;\6
\X3:Input the edges\X;\6
\X4:Output the graph\X;\6
\4${}\}{}$\2\par
\fi

\M{2}\B\X2:Input the vertices\X${}\E{}$\6
$\\{buf}[\\{bufsize}]\K\.{'\\n'};{}$\6
\&{if} ${}(\R\\{fgets}(\\{buf},\39\\{bufsize},\39\\{stdin})){}$\5
${}\{{}$\1\6
${}\\{fprintf}(\\{stderr},\39\.{"Couldn't\ read\ the\ v}\)\.{ariable-name\
line!\\n}\)\.{"});{}$\6
${}\\{exit}({-}\T{1});{}$\6
\4${}\}{}$\2\6
\&{for} ${}(\|n\K\|k\K\T{0};{}$ ${}\|n<\\{maxn};{}$ ${}\|n\PP){}$\5
${}\{{}$\1\6
\&{while} ${}(\\{buf}[\|k]\E\.{'\ '}){}$\1\5
${}\|k\PP;{}$\2\6
\&{if} ${}(\\{buf}[\|k]\E\.{'\\n'}){}$\1\5
\&{break};\2\6
\&{for} ${}(\|j\K\T{0};{}$ ${}\\{buf}[\|k]\I\.{'\ '}\W\\{buf}[\|k]\I\.{'\\n'}\W%
\|j\Z\\{maxl};{}$ ${}\|j\PP,\39\|k\PP){}$\1\5
${}\\{names}[\|n][\|j]\K\\{buf}[\|k];{}$\2\6
\&{if} ${}(\|j>\\{maxl}){}$\5
${}\{{}$\1\6
${}\\{fprintf}(\\{stderr},\39\.{"Vertex\ name\ is\ too\ }\)\.{long!\ \%s"},\39%
\\{buf}-\|k-\|j);{}$\6
${}\\{exit}({-}\T{2});{}$\6
\4${}\}{}$\2\6
\4${}\}{}$\2\6
${}\|g\K\\{gb\_new\_graph}(\|n);{}$\6
\&{for} ${}(\|k\K\T{0};{}$ ${}\|k<\|n;{}$ ${}\|k\PP){}$\1\5
${}(\|g\MG\\{vertices}+\|k)\MG\\{name}\K\\{gb\_save\_string}(\\{names}[%
\|k]);{}$\2\6
\\{hash\_setup}(\|g);\6
${}\\{printf}(\.{"I've\ created\ a\ grap}\)\.{h\ with\ \%d\ vertices..}\)\.{.%
\\n"},\39\|n){}$;\par
\U1.\fi

\M{3}\B\X3:Input the edges\X${}\E{}$\6
\&{for} ${}(\|m\K\T{0};{}$  ; ${}\|m\PP){}$\5
${}\{{}$\1\6
\&{if} ${}(\R\\{fgets}(\\{buf},\39\\{bufsize},\39\\{stdin})){}$\1\5
\&{break};\2\6
\&{for} ${}(\|k\K\T{0};{}$ ${}\\{buf}[\|k]\E\.{'\ '};{}$ ${}\|k\PP){}$\1\5
;\2\6
\&{for} ${}(\|j\K\T{0};{}$ ${}\\{buf}[\|k]\I\.{'\ '}\W\|j<\\{maxl};{}$ ${}\|j%
\PP,\39\|k\PP){}$\1\5
${}\\{nbuf}[\|j]\K\\{buf}[\|k];{}$\2\6
${}\\{nbuf}[\|j]\K\.{'\\0'};{}$\6
${}\|u\K\\{hash\_out}(\\{nbuf});{}$\6
\&{if} ${}(\R\|u){}$\5
${}\{{}$\1\6
${}\\{fprintf}(\\{stderr},\39\.{"Unknown\ first\ verte}\)\.{x:\ \%s"},\39%
\\{buf});{}$\6
${}\\{exit}({-}\T{3});{}$\6
\4${}\}{}$\2\6
\&{for} ( ; ${}\\{buf}[\|k]\E\.{'\ '};{}$ ${}\|k\PP){}$\1\5
;\2\6
\&{for} ${}(\|j\K\T{0};{}$ ${}\\{buf}[\|k]\I\.{'\ '}\W\|j<\\{maxl};{}$ ${}\|j%
\PP,\39\|k\PP){}$\1\5
${}\\{nbuf}[\|j]\K\\{buf}[\|k];{}$\2\6
${}\\{nbuf}[\|j]\K\.{'\\0'};{}$\6
${}\|v\K\\{hash\_out}(\\{nbuf});{}$\6
\&{if} ${}(\R\|v){}$\5
${}\{{}$\1\6
${}\\{fprintf}(\\{stderr},\39\.{"Unknown\ second\ vert}\)\.{ex:\ \%s"},\39%
\\{buf});{}$\6
${}\\{exit}({-}\T{4});{}$\6
\4${}\}{}$\2\6
\&{for} ( ; ${}\\{buf}[\|k]\E\.{'\ '};{}$ ${}\|k\PP){}$\1\5
;\2\6
\&{for} ${}(\|d\K\T{0};{}$ ${}\\{buf}[\|k]\G\.{'0'}\W\\{buf}[\|k]\Z\.{'9'};{}$
${}\|k\PP){}$\1\5
${}\|d\K\T{10}*\|d+\\{buf}[\|k]-\.{'0'};{}$\2\6
${}\\{gb\_new\_arc}(\|u,\39\|v,\39\|d);{}$\6
\4${}\}{}$\2\6
${}\\{printf}(\.{"\ and\ \%d\ arcs...\\n"},\39\|m){}$;\par
\U1.\fi

\M{4}\B\X4:Output the graph\X${}\E{}$\6
\&{if} ${}(\\{argc}>\T{1}){}$\5
${}\{{}$\1\6
${}\\{sprintf}(\|g\MG\\{id},\39\.{"\%.*s"},\39\.{ID\_FIELD\_SIZE}-\T{1},\39%
\\{argv}[\T{1}]);{}$\6
${}\\{sprintf}(\\{filenamebuf},\39\.{"/tmp/\%.*s.gb"},\39\.{ID\_FIELD\_SIZE}-%
\T{1},\39\\{argv}[\T{1}]);{}$\6
\4${}\}{}$\2\6
${}\\{save\_graph}(\|g,\39\\{filenamebuf});{}$\6
${}\\{printf}(\.{"\ and\ file\ \%s\ holds\ }\)\.{the\ result.\\n"},\39%
\\{filenamebuf}){}$;\par
\U1.\fi

\N{1}{5}Index.
\fi

\inx
\fin
\con
